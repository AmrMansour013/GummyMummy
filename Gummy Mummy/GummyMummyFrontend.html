<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gummy Mummy â€” Ø¯Ø¹Ù… Ù†Ø§Ø¹Ù… Ù„Ù„Ø£Ù…Ù‡Ø§Øª</title>
    <link rel="icon" href="https://via.placeholder.com/32/FFD1DC/FFFFFF?text=ğŸ‘¶" type="image/x-icon">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ------------------- CSS Styles (Unchanged) ------------------- */
        :root {
            --color-primary: #FFB6C1; --color-secondary: #ADD8E6; --color-text: #333; --color-muted: #6c757d;
            --color-card: rgba(255, 255, 255, 0.95); --color-success: #5CB85C; --color-moderate: #FFC107;
            --color-high: #DC3545; --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 25px rgba(0, 0, 0, 0.1); --radius: 16px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Cairo', system-ui, sans-serif; color: var(--color-text);
            background: linear-gradient(135deg, var(--color-primary) 0%, #FFF7E9 45%, var(--color-secondary) 100%);
            min-height: 100vh; display: flex; align-items: flex-start; justify-content: center;
            padding: 40px 18px; transition: background 0.5s ease;
        }
        body.low-urgency { background: linear-gradient(135deg, #A8E6CF 0%, #FFF7E9 50%, #B8E0F0 100%); }
        body.moderate-urgency { background: linear-gradient(135deg, #FFD1A6 0%, #FFF7E9 50%, #FFE0B2 100%); }
        body.high-urgency { background: linear-gradient(135deg, #FFB3BA 0%, #FFF7E9 50%, #FFD9D9 100%); }
        .app {
            width: 100%; max-width: 1080px; border-radius: 24px; background: var(--color-card);
            padding: 30px; box-shadow: var(--shadow-lg); overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; padding-bottom: 15px; }
        .brand { display: flex; align-items: center; gap: 15px; }
        .logo {
            width: 50px; height: 50px; border-radius: 50%; background: var(--color-primary);
            display: flex; align-items: center; justify-content: center; font-weight: 800;
            color: #fff; font-size: 1.5rem; box-shadow: var(--shadow-md);
        }
        h1 { font-size: 1.8rem; font-weight: 800; }
        p.lead { color: var(--color-muted); font-size: 0.9rem; margin-top: 2px; }
        .nav-links { display: flex; gap: 15px; font-size: 0.85rem; }
        .nav-links a { color: var(--color-muted); text-decoration: none; transition: color 0.2s; }
        .nav-links a:hover { color: var(--color-primary); }
        .main-layout { display: flex; gap: 25px; position: relative; }
        .right-sidebar { width: 280px; min-width: 280px; padding: 0; display: none; }
        .left-content { flex: 1; padding: 0; min-height: 500px; }
        .card {
            background: #fff; border-radius: var(--radius); padding: 20px;
            box-shadow: var(--shadow-md); margin-bottom: 20px;
        }
        label { display: block; font-weight: 600; margin: 12px 0 6px; font-size: 0.95rem; }
        input, select {
            width: 100%; padding: 12px 15px; border-radius: 10px; border: 1px solid #EEE;
            font-size: 0.95rem; background-color: #F8F8F8; transition: border-color 0.3s;
        }
        input:focus, select:focus {
            border-color: var(--color-primary); box-shadow: 0 0 0 3px rgba(255, 182, 193, 0.4); outline: none;
        }
        .row { display: flex; gap: 10px; margin-top: 8px; }
        .row .col { flex: 1; }
        .btn {
            display: inline-block; padding: 14px 20px; border-radius: 12px; border: none;
            background: linear-gradient(90deg, #FF69B4, #FF8EC9); color: #fff; font-weight: 700;
            cursor: pointer; margin-top: 15px; font-size: 1rem; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 105, 180, 0.4);
        }
        .btn:hover { transform: translateY(-2px); opacity: 0.9; }
        .btn.secondary { background: linear-gradient(90deg, #607D8B, #90A4AE); box-shadow: 0 4px 10px rgba(96, 125, 139, 0.3); }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .cards-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px; margin-top: 20px;
        }
        .section-card {
            background: #fdfdfd; border-radius: 12px; padding: 15px; cursor: pointer;
            display: flex; align-items: center; gap: 12px; transition: transform .3s ease, box-shadow .3s ease;
            border-left: 5px solid var(--color-primary);
        }
        .section-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05); }
        .icon {
            width: 48px; height: 48px; border-radius: 8px; display: flex; align-items: center;
            justify-content: center; font-size: 24px; background: rgba(255, 182, 193, 0.3);
        }
        .card-title { font-weight: 700; font-size: 1.1rem; }
        .card-sub { font-size: 0.85rem; color: var(--color-muted); }
        .register-view { width: 100%; max-width: 500px; margin: 0 auto; }
        .app-view { position: relative; min-height: 450px; overflow: hidden; display: none; }
        .view {
            position: absolute; inset: 0; transform: translateX(100%); opacity: 0; visibility: hidden;
            transition: transform 0.4s cubic-bezier(.2,.9,.3,1), opacity 0.3s; padding: 0;
        }
        .view.active { transform: translateX(0%); opacity: 1; visibility: visible; position: relative; }
        .back-btn {
            display: inline-block; margin-bottom: 20px; padding: 8px 15px; border-radius: 8px;
            background: rgba(0, 0, 0, 0.05); cursor: pointer; font-weight: 600; color: var(--color-muted);
            transition: background 0.2s;
        }
        .back-btn:hover { background: rgba(0, 0, 0, 0.1); }
        .advice-bubble {
            margin-top: 25px; padding: 20px; border-radius: 14px; background: #F4F7FF;
            box-shadow: var(--shadow-md); border-right: 6px solid var(--color-primary);
            white-space: pre-line; transition: all 0.5s ease;
        }
        .advice-bubble.low { border-right-color: var(--color-success); background: #E8F9E8; }
        .advice-bubble.moderate { border-right-color: var(--color-moderate); background: #FFFBE6; }
        .advice-bubble.high { border-right-color: var(--color-high); background: #FFE8E8; font-weight: 600; }
        @media(max-width: 880px) {
            .main-layout { flex-direction: column; gap: 0; }
            .right-sidebar { order: 2; width: 100%; min-width: unset; display: block !important; }
            .left-content { order: 1; min-height: unset; }
            .register-view { max-width: 100%; }
            header { flex-direction: column; gap: 10px; }
            .nav-links { margin-top: 10px; }
        }
        /* ------------------- END CSS Styles ------------------- */
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="brand">
                <div class="logo">GM</div>
                <div>
                    <h1>Gummy Mummy</h1>
                    <p class="lead">Ø¯Ø¹Ù… Ù†Ø§Ø¹Ù…ØŒ Ù†ØµØ§Ø¦Ø­ Ø´Ø®ØµÙŠØ© Ù„Ù„Ø£Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</p>
                </div>
            </div>
            <div class="nav-links">
                <a href="#" onclick="alert('Ù„Ù…Ø­Ø© Ø¹Ù† Ø±Ø¤ÙŠØªÙ†Ø§: Ø¯Ø¹Ù… Ø§Ù„Ø£Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù†ÙØ³ÙŠØ§Ù‹ ÙˆØ¬Ø³Ø¯ÙŠØ§Ù‹.')">Ù…Ù† Ù†Ø­Ù†</a>
                <a href="#">Ø§Ù„Ø®ØµÙˆØµÙŠØ©</a>
                <a href="#">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
                <span class="muted" id="statusMessage" style="margin-right: 15px;">Ø§ÙˆÙÙ„Ø§ÙŠÙ† Â· ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠØ§Ù‹</span>
            </div>
        </header>

        <div class="main-layout">
            <div class="left-content">
                <div class="register-view" id="registerView">
                    <div class="card">
                        <h3 style="margin-bottom:6px">ğŸ‘¶ Ø§Ø¨Ø¯Ø¦ÙŠ Ø±Ø­Ù„Ø© Ø¯Ø¹Ù…Ùƒ</h3>
                        <p class="muted">Ø§Ù…Ù„Ø¦ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù†Ù‚Ø¯Ù… Ù„Ùƒ Ù†Ø¸Ø§Ù… Ù†ØµØ§Ø¦Ø­ Ø´Ø®ØµÙŠ. (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)</p>

                        <form id="registerForm">
                            <label>Ø§Ù„Ø§Ø³Ù…</label>
                            <input id="name" placeholder="Ù…Ø«Ø§Ù„: Ø£Ù…Ù„">

                            <div class="row">
                                <div class="col">
                                    <label>Ø§Ù„Ø¹Ù…Ø± (Ø§Ù„Ø£Ù…)</label>
                                    <input id="age" type="number" min="15" max="60" placeholder="Ù…Ø«Ø§Ù„: 29">
                                </div>
                                <div class="col">
                                    <label>Ø¹Ù…Ø± Ø§Ù„Ø·ÙÙ„ (Ø¨Ø§Ù„Ø´Ù‡ÙˆØ±)</label>
                                    <input id="baby_age_months" type="number" min="0" placeholder="Ù…Ø«Ø§Ù„: 2">
                                </div>
                            </div>
                            
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø·ÙÙ„</label>
                            <select id="baby_gender">
                                <option value="" selected>ØºÙŠØ± Ù…Ø­Ø¯Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</option>
                                <option value="male">ÙˆÙ„Ø¯</option>
                                <option value="female">Ø¨Ù†Øª</option>
                                <option value="unknown">Ø£Ø®Ø±Ù‰/ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ</option>
                            </select>
                            
                            <label>Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø²ÙˆØ¬ÙŠØ©</label>
                            <select id="marital_status">
                                <option value="married" selected>Ù…ØªØ²ÙˆØ¬Ø©</option>
                                <option value="single">ØºÙŠØ± Ù…ØªØ²ÙˆØ¬Ø©</option>
                                <option value="divorced">Ù…Ø·Ù„Ù‚Ø©</option>
                                <option value="widowed">Ø£Ø±Ù…Ù„Ø©</option>
                                <option value="other">Ø£Ø®Ø±Ù‰</option>
                            </select>
                            
                            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input id="phone" type="tel" placeholder="+20123...">


                            <label>Ù‡Ù„ Ù‡Ø°Ø§ Ø£ÙˆÙ„ Ø·ÙÙ„ØŸ</label>
                            <select id="is_first_child">
                                <option value="true" selected>Ù†Ø¹Ù…</option>
                                <option value="false">Ù„Ø§</option>
                            </select>

                            <label>Ù‡Ù„ ØªØ±Ø¶Ø¹ÙŠÙ† Ø·Ø¨ÙŠØ¹ÙŠÙ‹Ø§ Ø§Ù„Ø¢Ù†ØŸ</label>
                            <select id="is_breastfeeding">
                                <option value="true" selected>Ù†Ø¹Ù…</option>
                                <option value="false">Ù„Ø§</option>
                            </select>
                            
                            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                            <input id="email" type="email" placeholder="you@email.com">

                            <button class="btn" type="submit">Ø³Ø¬Ù‘Ù„ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„Ø¯Ø¹Ù… â¤</button>
                            <div id="registerMsg" class="muted" style="margin-top:10px; font-weight: 600;"></div>
                        </form>
                    </div>
                </div>

                <div class="app-view" id="appViewsContainer" style="display: none;">
                    
                    <section id="view-home" class="view">
                        <div class="card">
                            <h3>ğŸ” Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…ØªØ®ØµØµØ©</h3>
                            <p class="muted" id="welcomeMsg">Ø£Ù‡Ù„Ø§Ù‹! Ø§Ø®ØªØ±ÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø°ÙŠ ØªÙˆØ¯ÙŠÙ† Ø§Ø³ØªØ´Ø§Ø±ØªÙ‡.</p>
                            <div class="cards-grid" id="cardsGrid">
                                </div>
                        </div>

                        <div id="tipBox" style="margin-top:20px; display:none;" class="card advice-bubble low">
                            **Ù†ØµÙŠØ­Ø© Ø³Ø±ÙŠØ¹Ø©:** Ø®ØµØµÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„Ø±Ø§Ø­Ø© Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†Ø§Ù… Ø§Ù„Ø·ÙÙ„ â€” Ø­ØªÙ‰ Ù‚ÙŠÙ„ÙˆÙ„Ø© ØµØºÙŠØ±Ø© ØªØ±ÙÙØ¹ Ù…Ù† Ø·Ø§Ù‚ØªÙƒ!
                        </div>
                    </section>

                    </div>
            </div>

            <div class="right-sidebar" id="sidebar">
                <div class="card">
                    <h3>ğŸ’¡ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                    <p class="muted">ØªÙ†Ù‚Ù„ Ø³Ø±ÙŠØ¹ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù….</p>
                    <div class="btn-group" style="margin-top:15px">
                        <button class="btn secondary" id="btnHome" onclick="goHome()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©/Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                        <button class="btn" onclick="showAdviceSample()">Ù†ØµÙŠØ­Ø© Ø§Ù„ÙŠÙˆÙ…</button>
                    </div>
                </div>

                <div class="card" id="userInfoCard">
                    <h3>Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</h3>
                    <p class="muted">Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„</p>
                    <input type="email" id="emailDisplay" disabled value="ØºÙŠØ± Ù…ØªÙˆÙØ±">
                    <p class="muted" style="margin-top: 10px;">Ø¹Ù…Ø± Ø§Ù„Ø·ÙÙ„: <span id="babyAgeDisplay" style="font-weight: 700;"></span> Ø´Ù‡Ø±</p>
                    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #EEE;">
                        <span class="muted" style="font-size: 0.75rem;">
                            Token: <span id="clientTokenDisplay" style="word-break: break-all;"></span>
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            Â© 2025 Gummy Mummy â€” Ù†Ø³Ø®Ø© Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù…Ø­Ù„ÙŠØ©
        </footer>
    </div>

    <script>
        // ---------- App State & Config ----------
        let clientProfile = null;
        let clientToken = null;
        // âš ï¸ ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 8005 Ù„ØªØ¬Ù†Ø¨ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        const BASE_URL = 'http://127.0.0.1:1000'; 

        // ØªØ¹Ø±ÙŠÙ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (ØªØ³ØªØ®Ø¯Ù… Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù€ Forms ÙˆØ§Ù„Ù€ Views)
        const cardsInfo = [
            { id: 'mothercare', title: 'Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø£Ù…', desc: 'ØªÙ‚ÙŠÙŠÙ… Ù†ÙØ³ÙŠ ÙˆØ¬Ø³Ø¯ÙŠ Ø³Ø±ÙŠØ¹', emoji: 'ğŸŒ¸', formId: 'form-mothercare', outId: 'out-mothercare', endpoint: 'mothercare' },
            { id: 'sleep', title: 'Ù†ÙˆÙ… Ø§Ù„Ø·ÙÙ„', desc: 'Ø±ÙˆØªÙŠÙ† ÙˆÙ†ØµØ§Ø¦Ø­ Ù„Ø±ÙˆØªÙŠÙ† Ù†ÙˆÙ… Ø£ÙØ¶Ù„', emoji: 'ğŸ’¤', formId: 'form-sleep', outId: 'out-sleep', endpoint: 'sleep' },
            { id: 'feeding', title: 'Ø§Ù„ØªØºØ°ÙŠØ©', desc: 'Ø±Ø¶Ø§Ø¹Ø©ØŒ Ø­Ù„ÙŠØ¨ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ÙˆØ²Ù†', emoji: 'ğŸ¼', formId: 'form-feeding', outId: 'out-feeding', endpoint: 'feeding' },
            { id: 'hygiene', title: 'Ø§Ù„Ù†Ø¸Ø§ÙØ©', desc: 'Ø§Ù„Ø­ÙØ§Ø¶ØŒ Ø§Ù„Ø³Ø±Ø© ÙˆØ§Ù„Ø¬Ù„Ø¯', emoji: 'ğŸ§¼', formId: 'form-hygiene', outId: 'out-hygiene', endpoint: 'hygiene' },
            { id: 'triage', title: 'Ø§Ù„Ø·ÙˆØ§Ø±Ø¦', desc: 'ØªÙˆØ¬ÙŠÙ‡ ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø£Ø¹Ø±Ø§Ø¶ Ù…Ù‚Ù„Ù‚Ø©', emoji: 'ğŸ©º', formId: 'form-triage', outId: 'out-triage', endpoint: 'triage' },
            { id: 'development', title: 'Ø§Ù„ØªØ·ÙˆØ±', desc: 'Ù…Ø±Ø§Ù‚Ø¨Ø© Ù…Ø±Ø§Ø­Ù„ Ù†Ù…Ùˆ Ø§Ù„Ø·ÙÙ„', emoji: 'ğŸŒ±', formId: 'form-development', outId: 'out-development', endpoint: 'development' }
        ];

        // ØªØ¹Ø±ÙŠÙ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ù„ÙƒÙ„ Ù‚Ø³Ù… (Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯)
        const sectionContents = {
            'mothercare': { title: 'Ø¹Ù†Ø§ÙŠØ© Ø§Ù„Ø£Ù…', desc: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†ÙØ³ÙŠØ© ÙˆØ§Ù„Ø¬Ø³Ø¯ÙŠØ©.', fields: [
                { label: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù‚Ù„Ù‚ (0-10)', name: 'anxiety_level', type: 'number', min: 0, max: 10, required: true, defaultValue: 4 },
                { label: 'Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø­Ø²Ù† (0-10)', name: 'sadness_level', type: 'number', min: 0, max: 10, required: true, defaultValue: 3 },
                { label: 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø±Ø§Ø­Ø©/Ø§Ù„Ù†ÙˆÙ… ÙŠÙˆÙ…ÙŠØ§Ù‹', name: 'resting_hours', type: 'number', step: 0.1, required: true, defaultValue: 6 },
                { label: 'Ù‡Ù„ ØªØªÙ†Ø§ÙˆÙ„ÙŠÙ† Ø·Ø¹Ø§Ù…Ø§Ù‹ Ø¬ÙŠØ¯Ø§Ù‹ØŸ', name: 'eating_well', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'ÙƒÙ… Ù…Ø±Ø© ØªØ­ØµÙ„ÙŠÙ† Ø¹Ù„Ù‰ Ø¯Ø¹Ù… (Ø£Ø³Ø¨ÙˆØ¹ÙŠØ§Ù‹)ØŸ', name: 'support_frequency', type: 'number', min: 0, required: true, defaultValue: 1 },
            ]},
            'sleep': { title: 'Ù†ÙˆÙ… Ø§Ù„Ø·ÙÙ„', desc: 'ØªÙˆØµÙŠØ§Øª Ù„Ø±ÙˆØªÙŠÙ† Ù†ÙˆÙ… Ø£ÙØ¶Ù„.', fields: [
                { label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†ÙˆÙ… Ø®Ù„Ø§Ù„ 24 Ø³Ø§Ø¹Ø© (Ø³Ø§Ø¹Ø§Øª)', name: 'total_sleep_24h', type: 'number', step: 0.1, required: true, defaultValue: 14 },
                { label: 'Ø£Ø·ÙˆÙ„ ÙØªØ±Ø© Ù†ÙˆÙ… Ù…ØªØµÙ„Ø© (Ø³Ø§Ø¹Ø§Øª)', name: 'longest_sleep_block_h', type: 'number', step: 0.1, required: true, defaultValue: 4 },
                { label: 'Ø¹Ø¯Ø¯ Ù…Ø±Ø§Øª Ø§Ù„Ø§Ø³ØªÙŠÙ‚Ø§Ø¸ Ù„ÙŠÙ„Ø§Ù‹', name: 'night_wake_ups', type: 'number', min: 0, required: true, defaultValue: 2 },
                { label: 'Ù‡Ù„ ÙŠÙ†Ø§Ù… Ø¨Ù…ÙØ±Ø¯Ù‡ØŸ', name: 'falls_asleep_alone', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
            ]},
            'feeding': { title: 'Ø§Ù„ØªØºØ°ÙŠØ©', desc: 'Ù†ØµÙŠØ­Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ø±Ø¶Ø§Ø¹Ø©/Ø§Ù„Ø­Ù„ÙŠØ¨ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ.', fields: [
                { label: 'Ù†ÙˆØ¹ Ø§Ù„ØªØºØ°ÙŠØ©', name: 'feeding_type', type: 'select', options: [{ v: 'breast', t: 'Ø±Ø¶Ø§Ø¹Ø© Ø·Ø¨ÙŠØ¹ÙŠØ©' }, { v: 'formula', t: 'Ø­Ù„ÙŠØ¨ ØµÙ†Ø§Ø¹ÙŠ' }, { v: 'mixed', t: 'Ù…Ø®ØªÙ„Ø·' }, { v: 'solids', t: 'Ø£Ø·Ø¹Ù…Ø© ØµÙ„Ø¨Ø©' }] },
                { label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø¶Ø¹Ø§Øª ÙŠÙˆÙ…ÙŠØ§Ù‹', name: 'feeds_per_day', type: 'number', min: 0, required: true, defaultValue: 8 },
                { label: 'Ø£Ù„Ù… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ù…Ø³Ø§ÙƒØŸ (Ø§Ù„Ø±Ø¶Ø§Ø¹Ø© Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠØ©)', name: 'pain_with_latch', type: 'select', options: [{ v: 'false', t: 'Ù„Ø§' }, { v: 'true', t: 'Ù†Ø¹Ù…' }] },
                { label: 'ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ù„ÙŠØ¨ Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ (Ù…Ù„/ÙŠÙˆÙ…) - Ø¥Ù† ÙˆÙØ¬Ø¯', name: 'formula_amount_ml_per_day', type: 'number', min: 0, defaultValue: 0 },
                { label: 'Ù‡Ù„ ØªÙ… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£Ø·Ø¹Ù…Ø© Ø§Ù„ØµÙ„Ø¨Ø©ØŸ (Ø¨Ø¹Ø¯ 6 Ø£Ø´Ù‡Ø±)', name: 'solids_introduced', type: 'select', options: [{ v: 'false', t: 'Ù„Ø§' }, { v: 'true', t: 'Ù†Ø¹Ù…' }] },
            ]},
            'hygiene': { title: 'Ø§Ù„Ù†Ø¸Ø§ÙØ©', desc: 'Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­ÙØ§Ø¶ ÙˆØ§Ù„Ø§Ø³ØªØ­Ù…Ø§Ù….', fields: [
                { label: 'Ø¹Ø¯Ø¯ ØªØ¨Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø­ÙØ§Ø¶ ÙŠÙˆÙ…ÙŠØ§Ù‹', name: 'diaper_changes_per_day', type: 'number', min: 0, required: true, defaultValue: 6 },
                { label: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ­Ù…Ø§Ù…Ø§Øª Ø¨Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹', name: 'bath_times_per_week', type: 'number', min: 0, required: true, defaultValue: 3 },
                { label: 'Ù‡Ù„ ÙŠÙˆØ¬Ø¯ Ø·ÙØ­ Ø¬Ù„Ø¯ÙŠØŸ', name: 'rash_present', type: 'select', options: [{ v: 'false', t: 'Ù„Ø§' }, { v: 'true', t: 'Ù†Ø¹Ù…' }] },
                { label: 'Ù‡Ù„ Ù‡Ù†Ø§Ùƒ Ø¥ÙØ±Ø§Ø²Ø§Øª Ù…Ù† Ø§Ù„Ø¹ÙŠÙ† Ø£Ùˆ Ø§Ù„Ø³Ø±Ø©ØŸ', name: 'eye_or_umbilical_discharge', type: 'select', options: [{ v: 'false', t: 'Ù„Ø§' }, { v: 'true', t: 'Ù†Ø¹Ù…' }] },
                { label: 'Ù‡Ù„ Ø§Ù„Ø³Ø±Ø© Ø¬Ø§ÙØ© ØªÙ…Ø§Ù…Ø§Ù‹ (Ù„Ù„Ø±Ø¶Ø¹ Ø§Ù„Ø¬Ø¯Ø¯)ØŸ', name: 'is_umbilical_dry', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
            ]},
            'triage': { title: 'Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ / Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø³Ø±ÙŠØ¹', desc: 'Ø§Ø®ØªØ± Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ÙˆØ³Ù†Ø±Ø´Ø¯Ùƒ ÙÙˆØ±Ø§Ù‹.', fields: [
                { label: 'Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Â°Ù…)', name: 'temp_celsius', type: 'number', step: 0.1, required: false },
                { label: 'Ø§Ù„Ø¹ÙØ±ÙØ¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ', name: 'main_symptom', type: 'select', options: [
                    { v: 'none', t: 'Ù„Ø§ ÙŠÙˆØ¬Ø¯' }, { v: 'cough', t: 'Ø³Ø¹Ø§Ù„' }, { v: 'diarrhea', t: 'Ø¥Ø³Ù‡Ø§Ù„' },
                    { v: 'crying', t: 'Ø¨ÙƒØ§Ø¡ Ù…Ø³ØªÙ…Ø±' }, { v: 'vomiting', t: 'Ù‚ÙŠØ¡' }, { v: 'fever', t: 'Ø­Ù…Ù‘Ù‰' }, { v: 'rash', t: 'Ø·ÙØ­ Ø¬Ù„Ø¯ÙŠ' }
                ]},
                { label: 'Ù…Ø¯Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø¨Ø§Ù„Ø£ÙŠØ§Ù…', name: 'symptom_duration_days', type: 'number', min: 0, required: false, defaultValue: 0 },
                { label: 'Ø´Ø¯Ø© Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶', name: 'symptom_severity', type: 'select', options: [{ v: 'mild', t: 'Ø®ÙÙŠÙØ©' }, { v: 'moderate', t: 'Ù…ØªÙˆØ³Ø·Ø©' }, { v: 'severe', t: 'Ø´Ø¯ÙŠØ¯Ø©' }] },
            ]},
            'development': { title: 'Ø§Ù„ØªØ·ÙˆØ± ÙˆØ§Ù„Ù†Ù…Ùˆ', desc: 'ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…ÙƒØªØ³Ø¨Ø©.', fields: [
                { label: 'Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø­Ø±ÙƒÙŠ - ÙŠÙ„ØªÙØŸ', name: 'gross_motor_rolls', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø­Ø±ÙƒÙŠ - ÙŠØ²Ø­ÙØŸ', name: 'gross_motor_crawls', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'Ø§Ù„Ù„ØºØ© - ÙŠØ®Ø±Ø®Ø±/ÙŠØµØ¯ÙØ± Ø£ØµÙˆØ§Øª Ø¨Ø³ÙŠØ·Ø©ØŸ', name: 'language_babbles', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'Ø§Ù„Ù„ØºØ© - ÙƒÙ„Ù…Ø§Øª Ù…ÙØ±Ø¯Ø©ØŸ', name: 'language_single_words', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ - ÙŠØ¨ØªØ³Ù…ØŸ', name: 'social_smiles', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
                { label: 'Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ - ØªÙˆØ§ØµÙ„ Ø¨ØµØ±ÙŠØŸ', name: 'social_eye_contact', type: 'select', options: [{ v: 'true', t: 'Ù†Ø¹Ù…' }, { v: 'false', t: 'Ù„Ø§' }] },
            ]},
        };


        // ------------------------------------
        // ---------- Initialization ----------
        // ------------------------------------

        function generateFieldHTML(field) {
            let inputHtml = `<label>${field.label}</label>`;
            const isSelect = field.type === 'select';
            const isNumber = field.type === 'number';

            const requiredAttr = field.required ? 'required' : ''; 

            if (isSelect) {
                inputHtml += `<select name="${field.name}" ${requiredAttr}>`;
                field.options.forEach(opt => {
                    inputHtml += `<option value="${opt.v}" ${opt.v === 'false' || opt.v === '' ? 'selected' : ''}>${opt.t}</option>`;
                });
                inputHtml += `</select>`;
            } else {
                inputHtml += `<input name="${field.name}" type="${field.type}" 
                              ${requiredAttr} 
                              ${isNumber ? 'step="' + (field.step || 1) + '"' : ''} 
                              ${field.min !== undefined ? 'min="' + field.min + '"' : ''}
                              value="${field.defaultValue !== undefined ? field.defaultValue : ''}"
                              >`;
            }
            return inputHtml;
        }

        function createSectionViews() {
            const appViewsContainer = document.getElementById('appViewsContainer');
            
            cardsInfo.forEach(c => {
                const info = sectionContents[c.id];
                if (!info) return;

                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Ø§Ù„ØµÙØ­Ø§Øª 3-8)
                const sectionEl = document.createElement('section');
                sectionEl.id = `view-${c.id}`;
                sectionEl.className = 'view';
                sectionEl.innerHTML = `
                    <div class="card">
                        <div class="back-btn" onclick="navigateTo('home')">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©</div>
                        <h2>${info.title}</h2>
                        <p class="muted">${info.desc}</p>
                        
                        <form id="${c.formId}" style="margin-top:15px"></form>

                        <div id="${c.outId}" class="advice-bubble" style="display:none"></div>
                    </div>
                `;
                appViewsContainer.appendChild(sectionEl);

                const form = document.getElementById(c.formId);
                if (form) {
                    info.fields.forEach(field => {
                        form.innerHTML += generateFieldHTML(field);
                    });
                    form.innerHTML += `<button class="btn" type="submit">Ø£Ø±Ù†ÙŠ Ø§Ù„Ù†ØµÙŠØ­Ø© Ø§Ù„Ù…Ø®ØµØµØ©</button>`;
                    form.addEventListener('submit', function (e) {
                        e.preventDefault();
                        const payload = (c.id === 'development') ? collectDevelopmentForm(this) : collectFormAsObject(this);
                        postSection(c.endpoint, payload, document.getElementById(c.outId));
                    });
                }
            });
            
            // Ø¥Ø¶Ø§ÙØ© Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¥Ù„Ù‰ Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ù„ØµÙØ­Ø© 2)
            const cardsGrid = document.getElementById('cardsGrid');
            cardsInfo.forEach(c => {
                const el = document.createElement('div');
                el.className = 'section-card';
                el.innerHTML = `<div class="icon">${c.emoji}</div>
                                <div><div class="card-title">${c.title}</div><div class="card-sub">${c.desc}</div></div>`;
                el.onclick = () => openSection(c.id);
                cardsGrid.appendChild(el);
            });

            // Ø¶Ø¨Ø· Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£ÙˆÙ„ÙŠ
            document.addEventListener('DOMContentLoaded', () => manageScreens('register'));
        }
        document.addEventListener('DOMContentLoaded', createSectionViews);


        // ------------------------------------
        // ---------- Navigation Logic ----------
        // ------------------------------------
        
        // ÙŠØ¯ÙŠØ± Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ© Ø§Ù„Ø«Ù…Ø§Ù†ÙŠØ©
        function manageScreens(targetView, sectionId = null) {
            const registerViewEl = document.getElementById('registerView');
            const appViewsContainerEl = document.getElementById('appViewsContainer');
            const sidebarEl = document.getElementById('sidebar');
            const allViews = document.querySelectorAll('.view');
            const mainHomeView = document.getElementById('view-home');
            
            // Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
            registerViewEl.style.display = 'none';
            appViewsContainerEl.style.display = 'none';
            sidebarEl.style.display = 'none';
            allViews.forEach(v => v.classList.remove('active'));

            if (targetView === 'register') {
                // Ø§Ù„Ø´Ø§Ø´Ø© 1: Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                registerViewEl.style.display = 'block';
                document.body.className = '';
            } else if (targetView === 'home') {
                // Ø§Ù„Ø´Ø§Ø´Ø© 2: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                appViewsContainerEl.style.display = 'block';
                mainHomeView.classList.add('active');
                sidebarEl.style.display = 'block';
                document.body.className = '';
            } else if (targetView === 'section' && sectionId) {
                // Ø§Ù„Ø´Ø§Ø´Ø§Øª 3-8: Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©
                appViewsContainerEl.style.display = 'block';
                sidebarEl.style.display = 'block';
                
                mainHomeView.classList.remove('active'); // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©

                const view = document.getElementById(`view-${sectionId}`);
                if (view) {
                    prefillView(sectionId);
                    setTimeout(() => view.classList.add('active'), 50);
                }
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function openSection(id) {
            if (!clientToken) {
                alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø³Ø¬Ù‘Ù„ÙŠ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø®ØµØµ.');
                return;
            }
            manageScreens('section', id);
        }

        function goHome() {
            manageScreens('home');
            document.body.className = '';
        }

        function navigateTo(page) {
            if (page === 'home') {
                goHome();
            } else {
                openSection(page);
            }
        }
        
        // ------------------------------------
        // ---------- Utility Functions ----------
        // ------------------------------------

        function collectFormAsObject(form) {
            const fd = new FormData(form);
            const obj = {};
            for (const [k, v] of fd.entries()) {
                if (v === 'true') obj[k] = true;
                else if (v === 'false') obj[k] = false;
                // âš ï¸ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ù„Ø§Ø³Ù„ Ø§Ù„Ù†ØµÙŠØ© Ø§Ù„ÙØ§Ø±ØºØ© Ø¥Ù„Ù‰ null Ù„Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯
                else if (v.trim() === '') obj[k] = null; 
                else if (!isNaN(v) && v.trim() !== '') obj[k] = (v.indexOf('.') !== -1) ? parseFloat(v) : parseInt(v);
                else obj[k] = v;
            }
            // ÙŠØ¬Ø¨ Ø£Ù† Ù†Ø±Ø³Ù„ baby_age_months Ø­ØªÙ‰ Ù„Ùˆ ÙƒØ§Ù† Ù…ÙƒØ±Ø±Ù‹Ø§ Ø£Ø­ÙŠØ§Ù†Ø§
            if (clientProfile && clientProfile.baby_age_months) {
                 obj.baby_age_months = clientProfile.baby_age_months;
            }
            return obj;
        }
        
        // Ø¯Ø§Ù„Ø© Ø®Ø§ØµØ© Ù„Ø¬Ù…Ø¹ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ·ÙˆØ± - ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡Ø§
        function collectDevelopmentForm(form) {
            const fd = new FormData(form);
            const payload = { gross_motor: {}, language: {}, social: {} };
            
            for (const [k, v] of fd.entries()) {
                if (k.startsWith('gross_motor_')) {
                    const skill = k.replace('gross_motor_', '');
                    payload.gross_motor[skill] = v === 'true';
                } else if (k.startsWith('language_')) {
                    const skill = k.replace('language_', '');
                    payload.language[skill] = v === 'true';
                } else if (k.startsWith('social_')) {
                    const skill = k.replace('social_', '');
                    payload.social[skill] = v === 'true';
                }
            }
            
            if (clientProfile && clientProfile.baby_age_months) {
                 payload.baby_age_months = clientProfile.baby_age_months;
            }
            return payload;
        }

        function prefillView(id) {
            if (!clientProfile) return;
            const formId = cardsInfo.find(c => c.id === id)?.formId;
            if (!formId) return;

            const form = document.getElementById(formId);
            if (!form) return;
        }
        
        function updateUrgencyStyle(urgency) {
            // ØªØ­Ø¯ÙŠØ« Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© (ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†)
            document.body.className = `${urgency}-urgency`;
            const statusMsg = document.getElementById('statusMessage');
            if (urgency === 'high') {
                statusMsg.innerHTML = `âš ï¸ <span style="color: var(--color-high); font-weight: 700;">Ø¥Ù†Ø°Ø§Ø±: ${urgency}</span>`;
            } else if (urgency === 'moderate') {
                statusMsg.innerHTML = `ğŸŸ¡ <span style="color: var(--color-moderate); font-weight: 700;">Ù…Ø±Ø§Ù‚Ø¨Ø©: ${urgency}</span>`;
            } else {
                 statusMsg.innerHTML = `ğŸŸ¢ <span style="color: var(--color-success); font-weight: 700;">Ø­Ø§Ù„Ø©: ${urgency}</span>`;
            }
        }

        function updateSidebarInfo() {
            if (clientProfile) {
                document.getElementById('emailDisplay').value = clientProfile.email || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                document.getElementById('babyAgeDisplay').textContent = clientProfile.baby_age_months;
            }
            if (clientToken) {
                document.getElementById('clientTokenDisplay').textContent = clientToken.substring(0, 30) + '...';
            }
        }


        // ------------------------------------
        // ---------- API Calls ----------
        // ------------------------------------

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const form = e.target;
            const msg = document.getElementById('registerMsg');
            msg.textContent = 'Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ ÙˆØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø®ØµØµ...';

            // 1. Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const payload = collectFormAsObject(form);
            
            // 2. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ØªÙŠ Ù†Ø­ØªØ§Ø¬Ù‡Ø§ Ø¨Ø´ÙƒÙ„ ØµØ±ÙŠØ­ (ÙˆØ®Ø§ØµØ© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ©)
            const emailValue = document.getElementById('email').value.trim() || null;
            const phoneValue = document.getElementById('phone').value.trim() || null; 
            const babyGenderValue = document.getElementById('baby_gender').value || null;
            const maritalStatusValue = document.getElementById('marital_status').value || null;

            // 3. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù€ payload Ù„Ù„ØªØ³Ø¬ÙŠÙ„ (Ù…Ø¹ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ø§Ù„Ù…Ø±Ø¦ÙŠØ©)
            const registerPayload = {
                // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© (ÙÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯)
                name: payload.name || null, 
                age: payload.age || null, 
                baby_age_months: payload.baby_age_months || null, 
                is_first_child: payload.is_first_child || null,
                is_breastfeeding: payload.is_breastfeeding || null,
                
                // Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø¶ÙÙ†Ø§Ù‡Ø§ (ØªØ±Ø³Ù„ null Ø¥Ø°Ø§ Ù„Ù… ÙŠÙ…Ù„Ø£Ù‡Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…)
                baby_gender: babyGenderValue, 
                marital_status: maritalStatusValue, 
                email: emailValue,
                phone: phoneValue,
            };
            
            // Ø·Ø¨Ø§Ø¹Ø© Ù…Ø§ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„Ù‡ Ù„Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ø®ÙŠØ±
            console.log("Payload being sent:", registerPayload);

            try {
                const res = await fetch(`${BASE_URL}/register`, {
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }, 
                    body: JSON.stringify(registerPayload)
                });
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ response Ø£ÙˆÙ„Ø§Ù‹
                if (!res.ok) {
                    throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${res.status}`);
                }
                
                const j = await res.json();
                
                if (j.ok) {
                    clientProfile = registerPayload;
                    clientToken = j.token;
                    
                    msg.textContent = j.message || 'ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù†ÙÙ‚Ù„Ùƒ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©.';
                    // Ù†Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ 'Ù…Ø³ØªØ®Ø¯Ù…' Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù… ÙØ§Ø±ØºÙ‹Ø§
                    document.getElementById('welcomeMsg').textContent = `Ø£Ù‡Ù„Ø§Ù‹ ${clientProfile.name || 'Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯'}ØŒ Ø¥Ù„ÙŠÙƒ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ø¯Ø¹Ù….`;
                    
                    updateSidebarInfo();

                    // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø© 2: Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                    setTimeout(() => manageScreens('home'), 500);

                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù† res.ok Ø®Ø§Ø·Ø¦Ø§Ù‹ØŒ Ù†Ø³ØªØ®Ø¯Ù… Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    const serverMessage = j.detail ? (j.detail[0]?.msg || JSON.stringify(j.detail)) : (j.message || 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ');
                    msg.textContent = `ØªØ¹Ø°Ø± Ø§Ù„ØªØ³Ø¬ÙŠÙ„: ${serverMessage}`;
                    console.error("Registration failed response:", j);
                }
            } catch (err) {
                msg.textContent = 'ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ÙØ° 8005.';
                console.error("Fetch/Connection Error:", err);
            }
        });

        async function postSection(section, payload, outEl) {
            if (!clientToken) return;

            outEl.style.display = 'none';
            outEl.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ...';
            outEl.style.display = 'block';
            outEl.className = 'advice-bubble';
            updateUrgencyStyle('low');

            try {
                const res = await fetch(`${BASE_URL}/section/${section}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${clientToken}` // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ù„Ù„Ø£Ù…Ø§Ù†
                    },
                    body: JSON.stringify(payload)
                });
                const j = await res.json();

                if (res.ok) {
                    const { status, score, urgency, diagnosis, advice } = j;
                    
                    // ØªØ­Ø¯ÙŠØ« ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ§Ù„Ø®Ù„ÙÙŠØ© (ØªÙØ§Ø¹Ù„ Ø§Ù„Ø£Ù„ÙˆØ§Ù†)
                    outEl.className = `advice-bubble ${urgency}`;
                    updateUrgencyStyle(urgency);

                    outEl.innerHTML = `
                        <strong>âœ… Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${status}
                        <br><strong>ğŸ“Š Ø§Ù„Ø¯Ø±Ø¬Ø©:</strong> ${score.toFixed(1)}/100
                        <br><strong>ğŸš¦ Ø§Ù„Ø§Ø³ØªØ¹Ø¬Ø§Ù„:</strong> <span style="font-weight:700;">${urgency.toUpperCase()}</span>
                        <br><strong>ğŸ§  Ø§Ù„ØªØ´Ø®ÙŠØµ:</strong> ${diagnosis || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªØ´Ø®ÙŠØµ Ù…Ø­Ø¯Ø¯'}
                        <hr style="opacity:.1; margin: 10px 0;">
                        <div style="font-weight: 500; font-size: 1.05rem;">
                            ${advice.replace(/\n/g, '<br>')}
                        </div>
                    `;
                } else {
                    outEl.className = 'advice-bubble high';
                    updateUrgencyStyle('high');
                    outEl.innerHTML = `
                        <strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</strong>
                        <br>Ø±Ù…Ø² Ø§Ù„Ø®Ø·Ø£: ${res.status}
                        <br>Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø§Ø¯Ù…: ${j.message_ar || j.detail || 'ØªØ¹Ø°Ø± Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨.'}
                    `;
                }
            } catch (err) {
                outEl.className = 'advice-bubble high';
                outEl.innerHTML = `
                    <strong>âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:</strong>
                    <br>ØªØ¹Ø°Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø®Ø§Ø¯Ù…. ØªØ£ÙƒØ¯ Ù…Ù† ØªØ´ØºÙŠÙ„Ù‡ (uvicorn) ÙˆØ£Ù† Ø§Ù„ØªÙˆÙƒÙ† Ø³Ù„ÙŠÙ….
                `;
            }
        }

        function showAdviceSample() {
            if (!clientProfile) {
                alert('Ø³Ø¬Ù‘Ù„ÙŠ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø£ÙˆÙ„Ø§Ù‹ Ù„ØªØ±Ù‰ Ù†ØµØ§Ø¦Ø­ Ù…Ø®ØµØµØ©.');
                return;
            }
            // ÙŠØ¸Ù‡Ø± Ø§Ù„Ù†ØµÙŠØ­Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
            manageScreens('home');
            document.getElementById('tipBox').className = 'card advice-bubble low';
            document.getElementById('tipBox').innerHTML = 'Ù†ØµÙŠØ­Ø© Ø³Ø±ÙŠØ¹Ø©: Ø®ØµØµÙŠ 10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù„Ù„Ø±Ø§Ø­Ø© Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙ†Ø§Ù… Ø§Ù„Ø·ÙÙ„ â€” Ø­ØªÙ‰ Ù‚ÙŠÙ„ÙˆÙ„Ø© ØµØºÙŠØ±Ø© ØªØ±ÙÙØ¹ Ù…Ù† Ø·Ø§Ù‚ØªÙƒ!';
            updateUrgencyStyle('low');
        }
    </script>
</body>
</html>
